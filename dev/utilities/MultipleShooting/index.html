<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Multiple Shooting Functionality · DiffEqFlux.jl</title><meta name="title" content="Multiple Shooting Functionality · DiffEqFlux.jl"/><meta property="og:title" content="Multiple Shooting Functionality · DiffEqFlux.jl"/><meta property="twitter:title" content="Multiple Shooting Functionality · DiffEqFlux.jl"/><meta name="description" content="Documentation for DiffEqFlux.jl."/><meta property="og:description" content="Documentation for DiffEqFlux.jl."/><meta property="twitter:description" content="Documentation for DiffEqFlux.jl."/><meta property="og:url" content="https://docs.sciml.ai/DiffEqFlux/stable/utilities/MultipleShooting/"/><meta property="twitter:url" content="https://docs.sciml.ai/DiffEqFlux/stable/utilities/MultipleShooting/"/><link rel="canonical" href="https://docs.sciml.ai/DiffEqFlux/stable/utilities/MultipleShooting/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DiffEqFlux.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DiffEqFlux.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">DiffEqFlux.jl: High Level Scientific Machine Learning (SciML) Pre-Built Architectures</a></li><li><span class="tocitem">Differential Equation Machine Learning Tutorials</span><ul><li><a class="tocitem" href="../../examples/neural_ode/">Neural Ordinary Differential Equations</a></li><li><a class="tocitem" href="../../examples/GPUs/">Neural ODEs on GPUs</a></li><li><a class="tocitem" href="../../examples/mnist_neural_ode/">GPU-based MNIST Neural ODE Classifier</a></li><li><a class="tocitem" href="../../examples/mnist_conv_neural_ode/">Convolutional Neural ODE MNIST Classifier on GPU</a></li><li><a class="tocitem" href="../../examples/augmented_neural_ode/">Augmented Neural Ordinary Differential Equations</a></li><li><a class="tocitem" href="../../examples/neural_sde/">Neural Stochastic Differential Equations With Method of Moments</a></li><li><a class="tocitem" href="../../examples/collocation/">Smoothed Collocation for Fast Two-Stage Training</a></li><li><a class="tocitem" href="../../examples/normalizing_flows/">Continuous Normalizing Flows</a></li><li><a class="tocitem" href="../../examples/hamiltonian_nn/">Hamiltonian Neural Network</a></li><li><a class="tocitem" href="../../examples/tensor_layer/">Physics-Informed Machine Learning (PIML) with TensorLayer</a></li><li><a class="tocitem" href="../../examples/multiple_shooting/">Multiple Shooting</a></li><li><a class="tocitem" href="../../examples/neural_ode_weather_forecast/">Weather forecasting with neural ODEs</a></li></ul></li><li><span class="tocitem">Layer APIs</span><ul><li><a class="tocitem" href="../../layers/BasisLayers/">Classical Basis Layers</a></li><li><a class="tocitem" href="../../layers/TensorLayer/">Tensor Product Layer</a></li><li><a class="tocitem" href="../../layers/CNFLayer/">Continuous Normalizing Flows Layer</a></li><li><a class="tocitem" href="../../layers/SplineLayer/">Spline Layer</a></li><li><a class="tocitem" href="../../layers/NeuralDELayers/">Neural Differential Equation Layers</a></li><li><a class="tocitem" href="../../layers/HamiltonianNN/">Hamiltonian Neural Network Layer</a></li></ul></li><li><span class="tocitem">Utility Function APIs</span><ul><li><a class="tocitem" href="../Collocation/">Smoothed Collocation</a></li><li class="is-active"><a class="tocitem" href>Multiple Shooting Functionality</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Utility Function APIs</a></li><li class="is-active"><a href>Multiple Shooting Functionality</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Multiple Shooting Functionality</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/DiffEqFlux.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/DiffEqFlux.jl/blob/master/docs/src/utilities/MultipleShooting.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Multiple-Shooting-Functionality"><a class="docs-heading-anchor" href="#Multiple-Shooting-Functionality">Multiple Shooting Functionality</a><a id="Multiple-Shooting-Functionality-1"></a><a class="docs-heading-anchor-permalink" href="#Multiple-Shooting-Functionality" title="Permalink"></a></h1><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The form of multiple shooting found here is a specialized form for implicit layer deep learning (known as data shooting) which assumes full observability of the underlying dynamics and lack of noise. For a more general implementation of multiple shooting, see the <a href="https://help.juliahub.com/jsmo/stable/">JuliaSimModelOptimizer</a>. For an implementation more directly tied to parameter estimation against data, see <a href="https://docs.sciml.ai/DiffEqParamEstim/stable/">DiffEqParamEstim.jl</a>.</p></div></div><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DiffEqFlux.multiple_shoot" href="#DiffEqFlux.multiple_shoot"><code>DiffEqFlux.multiple_shoot</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">multiple_shoot(p, ode_data, tsteps, prob, loss_function,
    [continuity_loss = _default_continuity_loss], solver, group_size;
    continuity_term = 100, kwargs...)</code></pre><p>Returns a total loss after trying a &#39;Direct multiple shooting&#39; on ODE data and an array of predictions from each of the groups (smaller intervals). In Direct Multiple Shooting, the Neural Network divides the interval into smaller intervals and solves for them separately. The default continuity term is 100, implying any losses arising from the non-continuity of 2 different groups will be scaled by 100.</p><p>Arguments:</p><ul><li><code>p</code>: The parameters of the Neural Network to be trained.</li><li><code>ode_data</code>: Original Data to be modelled.</li><li><code>tsteps</code>: Timesteps on which ode_data was calculated.</li><li><code>prob</code>: ODE problem that the Neural Network attempts to solve.</li><li><code>loss_function</code>: Any arbitrary function to calculate loss.</li><li><code>continuity_loss</code>: Function that takes states <span>$\hat{u}_{end}$</span> of group <span>$k$</span> and <span>$u_{0}$</span> of group <span>$k+1$</span> as input and calculates prediction continuity loss between them. If no custom <code>continuity_loss</code> is specified, <code>sum(abs, û_end - u_0)</code> is used.</li><li><code>solver</code>: ODE Solver algorithm.</li><li><code>group_size</code>: The group size achieved after splitting the ode_data into equal sizes.</li><li><code>continuity_term</code>: Weight term to ensure continuity of predictions throughout different groups.</li><li><code>kwargs</code>: Additional arguments splatted to the ODE solver. Refer to the <a href="https://docs.sciml.ai/SciMLSensitivity/stable/">Local Sensitivity Analysis</a> and <a href="https://docs.sciml.ai/DiffEqDocs/stable/basics/common_solver_opts/">Common Solver Arguments</a> documentation for more details.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The parameter &#39;continuity_term&#39; should be a relatively big number to enforce a large penalty whenever the last point of any group doesn&#39;t coincide with the first point of next group.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/DiffEqFlux.jl/blob/48bffa4fbffa3dac3b0abc0fc9b15b6023ece098/src/multiple_shooting.jl#L1-L35">source</a></section><section><div><pre><code class="language-julia hljs">multiple_shoot(p, ode_data, tsteps, ensembleprob, ensemblealg, loss_function,
    [continuity_loss = _default_continuity_loss], solver, group_size;
    continuity_term = 100, kwargs...)</code></pre><p>Returns a total loss after trying a &#39;Direct multiple shooting&#39; on ODE data and an array of predictions from each of the groups (smaller intervals). In Direct Multiple Shooting, the Neural Network divides the interval into smaller intervals and solves for them separately. The default continuity term is 100, implying any losses arising from the non-continuity of 2 different groups will be scaled by 100.</p><p>Arguments:</p><ul><li><code>p</code>: The parameters of the Neural Network to be trained.</li><li><code>ode_data</code>: Original Data to be modelled.</li><li><code>tsteps</code>: Timesteps on which ode_data was calculated.</li><li><code>ensemble_prob</code>: Ensemble problem that the Neural Network attempts to solve.</li><li><code>ensemble_alg</code>: Ensemble algorithm, e.g. <code>EnsembleThreads()</code></li><li><code>prob</code>: ODE problem that the Neural Network attempts to solve.</li><li><code>loss_function</code>: Any arbitrary function to calculate loss.</li><li><code>continuity_loss</code>: Function that takes states <span>$\hat{u}_{end}$</span> of group <span>$k$</span> and</li></ul><p><span>$u_{0}$</span> of group <span>$k+1$</span> as input and calculates prediction continuity loss between them. If no custom <code>continuity_loss</code> is specified, <code>sum(abs, û_end - u_0)</code> is used.</p><ul><li><code>solver</code>: ODE Solver algorithm.</li><li><code>group_size</code>: The group size achieved after splitting the ode_data into equal sizes.</li><li><code>continuity_term</code>: Weight term to ensure continuity of predictions throughout</li></ul><p>different groups.</p><ul><li><code>kwargs</code>: Additional arguments splatted to the ODE solver. Refer to the</li></ul><p><a href="https://docs.sciml.ai/SciMLSensitivity/stable/">Local Sensitivity Analysis</a> and <a href="https://docs.sciml.ai/DiffEqDocs/stable/basics/common_solver_opts/">Common Solver Arguments</a> documentation for more details.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The parameter &#39;continuity_term&#39; should be a relatively big number to enforce a large penalty whenever the last point of any group doesn&#39;t coincide with the first point of next group.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/DiffEqFlux.jl/blob/48bffa4fbffa3dac3b0abc0fc9b15b6023ece098/src/multiple_shooting.jl#L82-L118">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DiffEqFlux.group_ranges" href="#DiffEqFlux.group_ranges"><code>DiffEqFlux.group_ranges</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">group_ranges(datasize, groupsize)</code></pre><p>Get ranges that partition data of length <code>datasize</code> in groups of <code>groupsize</code> observations. If the data isn&#39;t perfectly dividable by <code>groupsize</code>, the last group contains the reminding observations.</p><p>Arguments:</p><ul><li><code>datasize</code>: amount of data points to be partitioned</li><li><code>groupsize</code>: maximum amount of observations in each group</li></ul><p>Example:</p><pre><code class="language-julia-repl hljs">julia&gt; group_ranges(10, 5)
3-element Vector{UnitRange{Int64}}:
 1:5
 5:9
 9:10</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/DiffEqFlux.jl/blob/48bffa4fbffa3dac3b0abc0fc9b15b6023ece098/src/multiple_shooting.jl#L184-L204">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Collocation/">« Smoothed Collocation</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Thursday 14 December 2023 07:58">Thursday 14 December 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
